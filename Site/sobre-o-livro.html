<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/style.css">
    <title>Sobre o Livro</title>
    <header>
        <div class="navegar">
            <div>
               <a href="index.html"><img src="imgs/logo2.png" alt=""></a> 
            </div>
            <ul class="menu">
                <li><a href="sobre-mim.html">Sobre Mim</a></li>
                <li><a href="forum.html">Fórum</a></li>
                <li><a href="sobre-o-livro.html">Sobre o Livro</a></li>
                <li><a href="cadastro.html">Cadastro</a></li>
            </ul>
        </div>
        <div class="acessar">
            <span id="b_usuario">usuário</span>
        </div>
        <div>
            <img src="imgs/user.png" alt="" style="width: 40px; height: 40px; padding-top: 5px; padding-left: 40px;">
        </div>
        <div>
            <img onclick="exibirMenu()" src="imgs/sandwich.png" alt="" style="width: 40px; height: 40px; padding-top: 5px; padding-left: 30px;">
        </div>
        <div class="menu_lateral" id="menu_lateral">
                <ul class="menu">
                <li><a href="sobre-mim.html">Configurações</a></li>
                <li><a href="painel.html">Verificar Painel</a></li>
                <li onclick="sair()"><a href="index.html">Sair</a></li>
            </ul>
        </div>
    </header>
</head>
<body>
    <section>
        <div class="faixa"></div>
        <div class="container-escuro">
            
            <div style=" padding-left:60px; width: 90%; height: 100%;">
                <embed src="pdf/amostra_livro.pdf" type="application/pdf" width="100%" height="500px" style="padding-top: 25px;"> 
            </div>
            <div class="book">
                
                <img src="imgs/capa-livro.jpg" style="width: 80%; height: 80%; padding-top: 25px;" alt="" > 
                <div class="kpi">
                    <div class="review">
                        <div class="cards" id="cardAquarios">
                            <div class="card-aquario">
                                <div class="desc-aquario">
                                    <div class="temperatura">
                                        <h1 id="media_rating" style="color: #10491B; padding-left: 50px;">--</h1>
                                        <h3 style="color: #10491B">Média de Avaliações</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>    
                <div class="rating">
                    <input type="radio" id="star5" name="rating" value="5" onchange="enviarAvaliacao(this.value)" />
                    <label for="star5" title="5 estrelas">★</label>
                    <input type="radio" id="star4" name="rating" value="4" onchange="enviarAvaliacao(this.value)" />
                    <label for="star4" title="4 estrelas">★</label>
                    <input type="radio" id="star3" name="rating" value="3" onchange="enviarAvaliacao(this.value)" />
                    <label for="star3" title="3 estrelas">★</label>
                    <input type="radio" id="star2" name="rating" value="2" onchange="enviarAvaliacao(this.value)" />
                    <label for="star2" title="2 estrelas">★</label>
                    <input type="radio" id="star1" name="rating" value="1" onchange="enviarAvaliacao(this.value)" />
                    <label for="star1" title="1 estrela">★</label> 
                </div>
            </div>

        </div>
        <div class="faixa"> </div>
    </section>
</body>
<footer>
    <span>Elaborado por João Ricardo Jortieke Junior, 2025.</span>
</footer>
</html>

<script>
    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    var menu = false;

    /* Autenticação */
    if (sessionStorage.ID_USUARIO == undefined) {
        alert("Você precisa estar logado para acessar esta página.");
        window.location = "/login.html"; 
    }

    const idUsuario = sessionStorage.ID_USUARIO;
    const idLivro = 1;

    function carregarMedia() {
    fetch("/avaliacao/media")
        .then(r => r.json())
        .then(dados => {
            document.getElementById("media_rating").innerText = dados[0].media ?? "0.0";
        });
    }

    carregarMedia();

    function enviarAvaliacao() {
    const nota = document.querySelector('input[name="rating"]:checked')?.value;

    if (!nota) {
        alert("Selecione uma nota.");
        return;
    }

    const idUsuario = sessionStorage.ID_USUARIO;

    if (!idUsuario) {
        alert("Usuário não está logado.");
        return;
    }

    fetch("/avaliacao/enviar", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idUsuario: idUsuario,
            idLivro: 1,
            nota: Number(nota)
        })
    })
    .then(r => {
        if (r.ok) {
            alert("Avaliação enviada.");
            carregarMedia();
        } else {
            alert("Erro ao enviar avaliação.");
        }
    });
}

    function exibirMenu(){
        if (menu == false) {
            menu = true;
            menu_lateral.style.display = "flex";
        } else { 
            menu = false;
            menu_lateral.style.display = "none";
        }
    }

    function sair(){
        sessionStorage.clear();
        window.location.href = "login.html";
    }
    

</script>